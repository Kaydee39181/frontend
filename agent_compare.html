<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Agent Compare</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="icon" type="image/x-icon" href="app.ico">
</head>
<body>
  <div class="shell">
    <header class="topbar">
      <div class="brand">
        <div class="logo">VS</div>
        <div>
          <div class="brand-title">Agent Compare</div>
          <div class="brand-sub">Upload agent contact list + compare against transactions</div>
        </div>
      </div>

      <nav class="nav">
        <a class="navlink" href="dashboard.html?file_id=" id="backLink">Back to Dashboard â†©</a>
        <a class="navlink" href="agents.html?file_id=" id="agentsLink">Agents</a>
      </nav>
    </header>

    <main class="grid">
      <section class="card hero">
        <h1>Compare Business Activity</h1>
        <p class="muted">
          Upload a single <b>.xlsx</b> or <b>.csv</b> file with at least 2 columns:
          one for <b>business name</b> and one for <b>phone number</b>.
          Extra columns are allowed and will be ignored.
        </p>

        <div class="upload-row">
          <input id="compareFileInput" type="file" accept=".xlsx,.csv" />
          <button class="btn" id="compareUploadBtn">Upload + Compare</button>
        </div>

        <div class="status" id="compareStatus">Waiting for compare file...</div>
        <p class="hint" id="compareSummary"></p>

        <div class="tips">
          <div class="chip">Returns businesses inactive for the last 7 days</div>
          <div class="chip">Uses only business name + phone number columns</div>
          <div class="chip">Missing names are marked as "Not seen this year"</div>
        </div>
      </section>

      <section class="card" id="comparePreviewCard" hidden>
        <div class="card-head">
          <h2>Preview Before Download</h2>
          <div class="actions">
            <button class="btn" id="compareDownloadBtn" disabled>Download Report (XLSX)</button>
          </div>
        </div>

        <div class="table-wrap">
          <table id="comparePreviewTable"></table>
        </div>
      </section>

      <section class="card" id="monthlyActivityCard" hidden>
        <div class="card-head">
          <h2>Monthly Agent Activity</h2>
          <div class="actions">
            <button class="btn" id="activityDownloadBtn" disabled>Download Monthly Sheet (XLSX)</button>
          </div>
        </div>

        <div class="filters">
          <div class="field">
            <label>Timeframe Mode</label>
            <select id="activityTimeframeMode">
              <option value="month" selected>Month</option>
              <option value="custom">Custom Date Range</option>
            </select>
          </div>

          <div class="field" id="activityMonthWrap">
            <label>Month</label>
            <input id="activityMonth" type="month" />
          </div>

          <div class="field">
            <label>Type</label>
            <select id="activityType">
              <option value="all" selected>All</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>

          <div class="field" id="activityCustomWrap" hidden>
            <label>Custom Start Date</label>
            <input id="activityStartDate" type="date" />
          </div>

          <div class="field" id="activityCustomWrapEnd" hidden>
            <label>Custom End Date</label>
            <input id="activityEndDate" type="date" />
          </div>

          <div class="actions">
            <button class="btn btn-ghost" id="activityGenerateBtn" disabled>Preview Timeframe</button>
          </div>
        </div>

        <p class="hint" id="activitySummary"></p>

        <div class="table-wrap">
          <table id="activityPreviewTable"></table>
        </div>
      </section>
    </main>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    window.FILE_ID = params.get("file_id");
    window.PAGE = "agent_compare";
    window.API_BASE = window.API_BASE || "https://backend-oaaq.onrender.com";
  </script>

  <script>
    document.getElementById("backLink").href = `dashboard.html?file_id=${encodeURIComponent(window.FILE_ID || "")}`;
    document.getElementById("agentsLink").href = `agents.html?file_id=${encodeURIComponent(window.FILE_ID || "")}`;
  </script>

  <script src="/static/app.js"></script>
</body>
</html>
